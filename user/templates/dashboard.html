{% extends "base.html" %}

{% block title %}Dashboard - SaaS Portal{% endblock %}
{% block header_title %}Dashboard{% endblock %}
{% block nav_dashboard_active %}active{% endblock %}

{% block content %}
<div class="content-card">
    <div class="card-title">
        <h2>Welcome, {{ user.full_name }}</h2>
    </div>
    
    <div>
        <p>Email: {{ user.email }}</p>
        <p>
            Role: 
            {% if is_root_admin %}
            <span class="badge badge-primary">Root Admin</span>
            {% else %}
            <span class="badge badge-info">User</span>
            {% endif %}
        </p>
        
        {% if is_root_admin %}
        <div style="margin-top: 15px;">
            <a href="/admin/" class="btn btn-primary">
                <i class="fas fa-cogs"></i> Access Admin Panel
            </a>
        </div>
        {% endif %}
    </div>
</div>

<div class="grid-container">
    <div class="content-card">
        <div class="card-title">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>Your Departments</h3>
                <a href="{% url 'department_list' %}" class="btn btn-primary btn-sm">View All</a>
            </div>
        </div>
        
        {% if departments %}
        <ul style="list-style: none; padding-left: 0;">
            {% for dept in departments %}
            <li style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>{{ dept.name }}</span>
                    <a href="{% url 'department_detail' dept.department_id %}" class="btn btn-primary btn-sm">
                        <i class="fas fa-eye"></i>
                    </a>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>You don't have any departments yet.</p>
        {% if is_root_admin %}
        <a href="{% url 'create_department' %}" class="btn btn-primary btn-sm">Create Department</a>
        {% endif %}
        {% endif %}
    </div>
    
    <div class="content-card">
        <div class="card-title">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>Active Subscriptions</h3>
                <a href="{% url 'subscription_list' %}" class="btn btn-primary btn-sm">View All</a>
            </div>
        </div>
        
        {% if subscriptions %}
        <ul style="list-style: none; padding-left: 0;">
            {% for sub in subscriptions %}
            <li style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>{{ sub.service_package.name }}</strong>
                        <div style="font-size: 12px; color: var(--secondary-color);">{{ sub.department.name }}</div>
                        <div style="font-size: 12px;">Expires: {{ sub.end_date|date:"M d, Y" }}</div>
                    </div>
                    <a href="{% url 'subscription_detail' sub.id %}" class="btn btn-primary btn-sm">
                        <i class="fas fa-eye"></i>
                    </a>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>No active subscriptions found.</p>
        <a href="{% url 'package_list' %}" class="btn btn-primary btn-sm">Browse Packages</a>
        {% endif %}
    </div>
    
    <div class="content-card">
        <div class="card-title">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>Your Services</h3>
                <a href="{% url 'package_list' %}" class="btn btn-primary btn-sm">Browse Services</a>
            </div>
        </div>
        
        {% if services %}
        <ul style="list-style: none; padding-left: 0;">
            {% for service in services %}
            <li style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
                <div>
                    <strong>{{ service.service_package.name }}</strong>
                    <div style="font-size: 12px; color: var(--secondary-color);">
                        Via {{ service.subscription.department.name }}
                    </div>
                    <div style="font-size: 12px;">
                        Expires: {{ service.subscription.end_date|date:"M d, Y" }}
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>You don't have access to any services yet.</p>
        <p style="font-size: 12px; color: var(--secondary-color);">
            A department admin needs to grant you access to services.
        </p>
        {% endif %}
    </div>
</div>
{% endblock %}
